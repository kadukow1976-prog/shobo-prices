<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Узнать стоимость ремонта — УграРемКомп</title>
<style>
  :root{
    --bg:#f6f7f9;--card:#fff;--text:#1f2328;--muted:#6b7280;--line:#e5e7eb;--brand:#16a34a;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif}
  .wrap{max-width:860px;margin:0 auto;padding:20px}
  h1{font-size:clamp(22px,3.6vw,32px);margin:0 0 14px}
  .panel{display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin:10px 0 14px}
  .input{flex:1 1 280px;min-width:260px;padding:12px 14px;border:1px solid var(--line);border-radius:10px;background:#fff}
  .btn{display:inline-flex;align-items:center;gap:8px;border:0;border-radius:10px;padding:12px 16px;cursor:pointer;user-select:none;white-space:nowrap}
  .btn-call{background:var(--brand);color:#fff;font-weight:600}
  .btn-call svg{width:18px;height:18px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:14px;overflow:hidden}
  table{width:100%;border-collapse:collapse}
  th,td{padding:14px 16px;border-bottom:1px solid var(--line);vertical-align:top}
  th{background:#fafafa;text-align:left;color:#374151;font-weight:700}
  td.price{text-align:right;white-space:nowrap;font-variant-numeric:tabular-nums}
  .muted{color:var(--muted);font-size:13px}
  .error{color:#b91c1c;background:#fee2e2;border:1px solid #fecaca;border-radius:12px;padding:12px 14px}
  .counter{margin-top:10px}
  .hide{display:none}
  .copy{font-family:ui-monospace, SFMono-Regular, Menlo, monospace;font-size:12px;background:#0f172a;color:#e2e8f0;
        padding:10px 12px;border-radius:8px;overflow:auto}
  .badge{display:inline-block;padding:4px 10px;border:1px solid var(--line);border-radius:999px;font-size:12px;color:#374151;background:#fff}
</style>
</head>
<body>
  <div class="wrap">
    <div class="panel" style="justify-content:space-between;gap:14px">
      <h1 style="margin:0">Узнать стоимость ремонта</h1>
      <a class="btn btn-call" href="tel:+79107116072" title="Позвонить">
        <svg viewBox="0 0 24 24" fill="none"><path d="M22 16.92v2a2 2 0 0 1-2.18 2 19.8 19.8 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.8 19.8 0 0 1-3.07-8.67A2 2 0 0 1 4.09 1h2a2 2 0 0 1 2 1.72c.13.98.36 1.93.69 2.84a2 2 0 0 1-.45 2.11L7.09 8.91a16 16 0 0 0 6 6l1.24-1.24a2 2 0 0 1 2.11-.45c.91.33 1.86.56 2.84.69A2 2 0 0 1 22 16.92Z" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        Позвонить
      </a>
    </div>

    <div class="panel">
      <input id="q" class="input" placeholder='Опишите проблему: «разбит экран», «не заряжается», «вирусы»'>
      <span class="badge" id="badgeLoaded">Загружено: 0</span>
    </div>

    <div id="err" class="error hide"></div>

    <div class="card">
      <table id="tbl">
        <thead>
          <tr><th>Проблема</th><th class="price">Цена</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="counter muted" id="counter">Найдено: 0</div>

    <!-- Подсказка и место для быстрой правки ссылки -->
    <details style="margin-top:16px">
      <summary class="muted">Где править ссылку на таблицу (админ-подсказка)</summary>
      <p class="muted">Ниже строка с URL CSV. При необходимости замените её на новую из Google Таблиц (Файл → Опубликовать в интернете → «Прайс» → «Значения, разделённые запятыми (CSV)»).</p>
      <pre class="copy" id="csvLine"></pre>
    </details>
  </div>

<script>
  // <<< ВАЖНО: вставь сюда свою ссылку на CSV из Google Таблиц >>>
  const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQBjrIZhKXqFtutZJChMn-zej9fqm679V6aMTW6pXqF19PivgbeYIO0mL_UiNx3WryYzyFxOcDwpPYh/pub?gid=0&single=true&output=csv
  document.getElementById('csvLine').textContent = `const CSV_URL = "${CSV_URL}";`;

  // Нормализация текста для поиска
  const norm = s => (s||"")
    .toString()
    .toLowerCase()
    .replaceAll('ё','е')
    .replace(/[^\p{L}\p{N}\s\-_.]/gu,' ')
    .replace(/\s+/g,' ')
    .trim();

  // Парсер CSV (простой, без кавычек внутри ячеек)
  function parseCSV(txt){
    const rows = txt.trim().split(/\r?\n/).map(r=>r.split(',').map(c=>c.trim()));
    // Ожидаем заголовки: Проблема, Цена  (или problem, price)
    const head = rows.shift().map(norm);
    const iProblem = head.findIndex(h => /(проблем|name|наимен)/.test(h));
    const iPrice   = head.findIndex(h => /(цен)/.test(h) || h==='price');
    if(iProblem<0 || iPrice<0) throw new Error('В CSV должны быть столбцы «Проблема» и «Цена».');

    return rows
      .filter(r=>r.length)
      .map(r=>{
        const name = r[iProblem]||"";
        const priceRaw = r[iPrice]||"";
        const price = Number(String(priceRaw).replace(/\s+/g,'').replace(',', '.').replace(/[^0-9.]/g,''));
        return { name, price: isFinite(price) ? price : null };
      });
  }

  // Формат денег
  const fmt = n => (n==null ? '—' : n.toLocaleString('ru-RU')) + ' ₽';

  // Рендер
  const $tbody = document.querySelector('#tbl tbody');
  const $count = document.getElementById('counter');
  const $badge = document.getElementById('badgeLoaded');
  function render(list){
    $tbody.innerHTML = '';
    for(const row of list){
      const tr = document.createElement('tr');
      const tdN = document.createElement('td');
      tdN.textContent = row.name;
      const tdP = document.createElement('td');
      tdP.className = 'price';
      tdP.textContent = fmt(row.price);
      tr.append(tdN, tdP);
      $tbody.appendChild(tr);
    }
    $count.textContent = 'Найдено: ' + list.length;
  }

  // Фильтр
  let ALL = [];
  function applyFilter(){
    const q = norm(document.getElementById('q').value);
    if(!q){ render(ALL); return; }
    const words = q.split(' ');
    const out = ALL.filter(r=>{
      const t = norm(r.name);
      return words.every(w => t.includes(w));
    });
    render(out);
  }

  // Debounce
  let tmr;
  document.getElementById('q').addEventListener('input', ()=>{
    clearTimeout(tmr); tmr = setTimeout(applyFilter, 120);
  });

  // Загрузка CSV
  (async ()=>{
    const $err = document.getElementById('err');
    try{
      const res = await fetch(CSV_URL, {cache:'no-store'});
      if(!res.ok) throw new Error('HTTP '+res.status);
      const txt = await res.text();
      ALL = parseCSV(txt);
      render(ALL);
      $badge.textContent = 'Загружено: ' + ALL.length;
    }catch(e){
      $err.textContent = 'Ошибка загрузки прайса: ' + e.message + '. Проверь ссылку публикации CSV.';
      $err.classList.remove('hide');
    }
  })();
</script>
</body>
</html>
